# APC Processing - WeGo

The following notebook provides code to clean the APC data and merge with the GTFS data across time. For most people who are interested in analysis, you can directly jump to step 2 and work with the cleaned up data.

## 1. Available data files

* data.zip (raw APC and GTFS data), only necessary if you want the raw APC data: https://vanderbilt365.sharepoint.com/:u:/r/sites/TransitHub/Shared%20Documents/General/datasets/wego-occupancy/APCData/dashboard/data.zip?csf=1&web=1&e=3vRDE3
* wegoapc_dashboard.csv.zip (processed APC data, generated by wego_apc_dataprep.ipynb): https://vanderbilt365.sharepoint.com/:u:/r/sites/TransitHub/Shared%20Documents/General/datasets/wego-occupancy/APCData/dashboard/wegoapc_dashboard.csv.zip?csf=1&web=1&e=i7lbEU
* processed gtfs files (provided by Nashville Metro): https://vanderbilt365.sharepoint.com/:f:/r/sites/TransitHub/Shared%20Documents/General/datasets/wego-occupancy/APCData/Trips%20%26%20Stop%20Sequences?csf=1&web=1&e=pWE91n
  

Notes: the data/ directory holds all raw data (APC and GTFS) required by wego_apc_dataprep.ipynb. The
  output/ directory is where wego_apc_dataprep.ipynb writes the processed files.


## 2. Data schema for processed dataset (wegoapc_dashboard.csv)


| Field | Source | Description |
|:-----:|:------:|:-----------:|
| trip_id  | APC, GTFS | unique trip identifier |
| actual_arrival_time | APC | time when vehicle actually arrived at stop {hour}:{min}:{sec} |
| stop_lat | GTFS | latitude of this pickup location (stop) |
| stop_lon | GTFS | longitude of this pickup location (stop) |
| route_id | GTFS | unique route identifier |
| direction_id | GTFS | direction of travel along this route. 0 is outbound, 1 is inbound |
| stop_sequence | GTFS | each trip has an ordered sequence of stops visited, this is the sequence # of stop: stop_id in trip: trip_id |
| board_count | APC | number of passengers boarding at this stop |
| alight_count | APC | number of passengers exiting vehicle at this stop |
| occupancy | APC | number of passengers on vehicle after vehicle leaves this stop ( occupancy = occupancy + board_count - alight_count) |
| stop_id | APC, GTFS | unique stop identifier |
| initial_load | APC | initial number of passengers on vehicle when starting that trip |
| trip_start_time | APC | represents the time at which this trip started. should be the same for all stops visited for a given trip |
| from_apc | APC | 1 if this record was from the APC data, 0 if generated from trips file |
| version | GTFS | matches the GTFS version |
| date | APC | date of vehicle arriving at this stop {year}-{month}-{day}|
| day_of_week | APC | the day of the week (0, 1, .... 6) |


what we don't have
* scheduled_arrival_time
* lots of missing actual_arrival_time
* hour

## 3. Reference documentation

Note that a good reference for GTFS is: https://developers.google.com/transit/gtfs/reference. A good starting python package for gtfs is https://pypi.org/project/gtfs-functions/

Note that a good reference for GTFS is: https://developers.google.com/transit/gtfs/reference. A good starting python package for gtfs is https://pypi.org/project/gtfs-functions/